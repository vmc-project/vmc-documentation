<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.55.6" />
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title> :: VMC</title>

    
    <link href="/css/nucleus.css?1564490325" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1564490325" rel="stylesheet">
    <link href="/css/hybrid.css?1564490325" rel="stylesheet">
    <link href="/css/featherlight.min.css?1564490325" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1564490325" rel="stylesheet">
    <link href="/css/auto-complete.css?1564490325" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1564490325" rel="stylesheet">
    <link href="/css/theme.css?1564490325" rel="stylesheet">
    <link href="/css/hugo-theme.css?1564490325" rel="stylesheet">
    
      <link href="/css/theme-blue.css?1564490325" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1564490325"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/_multiple/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <img src="/images/VMClogo6.png" width=80% />

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1564490325"></script>
<script type="text/javascript" src="/js/auto-complete.js?1564490325"></script>
<script type="text/javascript">
    
        var baseurl = "http:\/\/example.org\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1564490325"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/download/" title="" class="dd-item 
        
        
        
        ">
      <a href="/download/">
          <b>1. </b>Download
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/installation/" title="Installation" class="dd-item 
        
        
        
        ">
      <a href="/installation/">
          <b>2. </b>Installation
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/installation/vmc/" title="Installing VMC" class="dd-item ">
        <a href="/installation/vmc/">
        VMC
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/installation/geant3/" title="Installing Geant3" class="dd-item 
        
        
        
        ">
      <a href="/installation/geant3/">
          Geant3
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/installation/geant4_vmc/" title="Installing Geant4 VMC" class="dd-item 
        
        
        
        ">
      <a href="/installation/geant4_vmc/">
          Geant4 VMC
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/installation/examples/" title="Installing and Running Examples" class="dd-item 
        
        
        
        ">
      <a href="/installation/examples/">
          Examples
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/vmc/" title="VMC" class="dd-item 
        
        
        
        ">
      <a href="/vmc/">
          <b>3. </b>VMC
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/examples/" title="" class="dd-item 
        
        
        
        ">
      <a href="/examples/">
          <b>4. </b>Examples
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/geant4_vmc/" title="Geant4 VMC" class="dd-item 
        
        
        
        ">
      <a href="/geant4_vmc/">
          <b>5. </b>Geant4 VMC
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/geometry-definition-navigation/" title="Geometry Definition &amp; Navigation" class="dd-item ">
        <a href="/geant4_vmc/geometry-definition-navigation/">
        Geometry Definition &amp; Navigation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/magnetic-field/" title="Magnetic Field" class="dd-item ">
        <a href="/geant4_vmc/magnetic-field/">
        Magnetic Field
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/sensitive-volumes/" title="Sensitive Detectors and Volumes" class="dd-item ">
        <a href="/geant4_vmc/sensitive-volumes/">
        Sensitive Detectors and Volumes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/physics-lists/" title="Physics Lists" class="dd-item ">
        <a href="/geant4_vmc/physics-lists/">
        Physics Lists
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/stacking-of-particles/" title="Stacking of Particles" class="dd-item ">
        <a href="/geant4_vmc/stacking-of-particles/">
        Stacking of Particles
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/special-cuts-and-regions/" title="Special Cuts and Regions" class="dd-item ">
        <a href="/geant4_vmc/special-cuts-and-regions/">
        Special Cuts and Regions
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/user-geant4-classes/" title="User Geant4 Classes" class="dd-item ">
        <a href="/geant4_vmc/user-geant4-classes/">
        User Geant4 Classes
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/visualization/" title="Visualization" class="dd-item ">
        <a href="/geant4_vmc/visualization/">
        Visualization
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/switching-user-interfaces/" title="Switching User Interfaces" class="dd-item ">
        <a href="/geant4_vmc/switching-user-interfaces/">
        Switching User Interfaces
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/multi-threaded-processing/" title="Multi-threaded Processing" class="dd-item ">
        <a href="/geant4_vmc/multi-threaded-processing/">
        Multi-threaded Processing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/verbosity/" title="Vebosity" class="dd-item ">
        <a href="/geant4_vmc/verbosity/">
        Vebosity
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/vebosity-for-developers/" title="Vebosity for Developers" class="dd-item ">
        <a href="/geant4_vmc/vebosity-for-developers/">
        Vebosity for Developers
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/geant4_vmc/source-code-documentation/" title="Source code documentation" class="dd-item ">
        <a href="/geant4_vmc/source-code-documentation/">
        Source code documentation
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/geant3&#43;vmc/" title="Geant3 &#43; VMC" class="dd-item 
        
        
        
        ">
      <a href="/geant3&#43;vmc/">
          <b>6. </b>Geant3 &#43; VMC
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/g4root/" title="G4Root" class="dd-item 
        
        
        
        ">
      <a href="/g4root/">
          <b>7. </b>G4Root
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/mtroot/" title="MTRoot" class="dd-item 
        
        
        
        ">
      <a href="/mtroot/">
          <b>8. </b>MTRoot
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/publications/" title="Publications" class="dd-item 
        
        
        
        ">
      <a href="/publications/">
          <b>9. </b>Publications
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/support/" title="Support" class="dd-item 
        
        
        
        ">
      <a href="/support/">
          <b>10. </b>Support
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/support/mailing-list/" title="Mailing List" class="dd-item ">
        <a href="/support/mailing-list/">
        Mailing List
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/support/bug-reports/" title="Bug Reports" class="dd-item ">
        <a href="/support/bug-reports/">
        Bug Reports
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>VMC Documentation</a> > 
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#multiple-vmc-engines">Multiple VMC Engines</a>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#running-multiple-different-engines">Running multiple different engines</a>
<ul>
<li><a href="#workflow">Workflow</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              
            </h1>
          

        





<p>\page refMultipleVMCEngines Multiple VMC Engines</p>

<h1 id="multiple-vmc-engines">Multiple VMC Engines</h1>

<h2 id="overview">Overview</h2>

<p>The VMC package provides an abstract interface for Monte Carlo transport engines. Interfaces are implemented for
* <a href="https://github.com/vmc-project/geant3">GEANT3</a>
* <a href="https://github.com/vmc-project/geant4_vmc">GEANT4</a></p>

<p>each deriving from <code>TVirtualMC</code> implementing all necessary methods.</p>

<p>Before a user can instantiate an engine, an object deriving from <code>TVirtualMCApplication</code> needs to be present which has to be implemented by the user. It contains necessary hooks called from the <code>TVirtualMC</code>s depending on their internal state. At the same time it provides the bridge between the user code and VMC. For instance, the user code can contain the geometry construction routines somewhere which should be called from the implemented <code>UserApplication::ConstructGeometry()</code>.</p>

<p>Further general information on the VMC project can be found <a href="https://root.cern.ch/vmc">here</a></p>

<h2 id="running-multiple-different-engines">Running multiple different engines</h2>

<p>The simulation of an event can be shared among multiple different engines deriving from <code>TVirtualMC</code> which are handled by a singleton <code>TMCManager</code> object. In such a scenario the user has to call <code>TVirtualMCApplication::RequestMCManager()</code> in the constructor of the user application. A pointer to the manager object is then available via the protected <code>TVirtualMCApplication::fMCManager</code> but can also be obtained using the static method <code>TMCManager *TMCManager::Instance()</code>.</p>

<p><code>TMCManager</code> provides the following interfaces:</p>

<ul>
<li><code>void SetUserStack(TVirtualMCStack* userStack)</code> notifies the manager on the user stack such that it will be kept up-to-date during the simulation. Running without having set the user stack is not possible and the <code>TMCManager</code> will abort in that case.</li>
<li><code>void ForwardTrack(Int_t toBeDone, Int_t trackId, Int_t parentId, TParticle* userParticle)</code>: The user is still the owner of all track objects (aka <code>TParticle</code>) being created. Hence, all engine calls to <code>TVirtualMCStack::PushTrack(...)</code> are forwarded to the user stack. This can then invoke the <code>ForwardTrack(..)</code> method of the manager to pass the pointer to the constructed <code>TParticle</code> object. If a particle should be pushed to an engine other than the one currently running the engine&rsquo;s id has to be provided as the last argument.</li>
<li><code>void TransferTrack(Int_t targetEngineId)</code>: E.g. during <code>TVirtualMCApplication::Stepping()</code> the user might decide that the current track should be transferred to another engine, for instance, if a certain volume is entered. Specifying the ID of the target engine the manager will take care of interrupting the track in the current engine, extracting the kinematics and geometry state and it will push this to the stack of the target engine.</li>
<li><code>template &lt;typename F&gt; void Apply(F f)</code> assumes <code>f</code> to implement the <code>()</code> operator and taking a <code>TVirtualMC</code> pointer as an arument. <code>f</code> will be then called for all engines.</li>
<li><code>template &lt;typename F&gt; void Init(F f)</code> works as <code>TMCManager::Apply</code> during the initialization of the engines. It can also be called without an argument such that no additional user routine is included.</li>
<li><code>void Run(Int_t nEvents)</code> steers a run for the specified number of events.</li>
<li><code>void ConnectEnginePointers(TVirtualMC *&amp;mc)</code> gives the possibility for a user to pass a pointer which will always be set to point to the currently running engine.</li>
<li><code>TVirtualMC *GetCurrentEngine()</code> provides the user with the currently running engine.</li>
</ul>

<p>An example of how the <code>TMCManager</code> is utilized in a multi-run can be found in <code>examples/EME</code> of the <a href="https://github.com/vmc-project/geant4_vmc">GEANT4_VMC repository</a>.</p>

<h3 id="workflow">Workflow</h3>

<p><strong>Implementation</strong>
1. Implement your application as you have done before. Request the <code>TMCManager</code> in your constructor if needed via <code>TVirtualMCApplication::RequestMCManager()</code>
2. Implement your user stack as you have done before. At an appropriate stage (e.g. in <code>UserStack::PushTrack(...)</code>) you should call <code>TMCManager::ForwardTrack(...)</code> to forward the pointers to your newly constructed <code>TParticle</code> objects.
3. Set your stack using <code>TMCManager::SetUserStack(...)</code>.</p>

<p><strong>Usage</strong>
1. Instantiate your application
2. Instantiate the engines you want to use.
3. Call <code>TMCManager::Init(...)</code>.
4. Call <code>TMCManager::Run(...)</code></p>

<p><strong>Further comments</strong></p>

<p>The geometry is built once centrally via the <code>TMCManager</code> calling</p>

<ol>
<li><code>TVirtualMCApplication::ConstructGeometry()</code></li>
<li><code>TVirtualMCApplication::MisalignGeometry()</code></li>
<li><code>TVirtualMCApplication::ConstructOpGeometry()</code></li>
</ol>

<p>so it is expected that these methods do not depend on any engine.</p>

<p>If multiple engines have been instantiated, never call <code>TVirtualMC::ProcessRun(...)</code> or other steering methods on the engine since that would bypass the <code>TMCManager</code></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
		
			<a class="nav nav-next" href="/download/" title="" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1564490325"></script>
    <script src="/js/perfect-scrollbar.min.js?1564490325"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1564490325"></script>
    <script src="/js/jquery.sticky.js?1564490325"></script>
    <script src="/js/featherlight.min.js?1564490325"></script>
    <script src="/js/html5shiv-printshiv.min.js?1564490325"></script>
    <script src="/js/highlight.pack.js?1564490325"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1564490325"></script>
    <script src="/js/learn.js?1564490325"></script>
    <script src="/js/hugo-learn.js?1564490325"></script>

    <link href="/mermaid/mermaid.css?1564490325" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1564490325"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

